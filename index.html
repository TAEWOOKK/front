<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>

  <!-- Add your site or application content here -->
  <p>메인 페이지 입니다.</p>
  <button type="button" onclick="location.href='signup.html'">회원가입 페이지 이동</button>
  <button type="button" onclick="location.href='login.html'">로그인 페이지 이동</button>
  <button type="button" onclick="user()">user 권한 확인</button>
  <button type="button" onclick="adminauth()">권한확인</button>
  <button type="button" onclick="logout()">로그아웃</button>
</body>
<script>
  function user(){

    // 로컬 스토리지에서 'access'라는 키로 저장된 값 가져오기
    var accessToken = localStorage.getItem('access');
    console.log(accessToken)
    $.ajax({
      type: "GET",
      url: "http://localhost:8081/user",
      dataType : 'text',
      beforeSend: function(xhr) {
        // 'Authorization' 헤더에 가져온 accessToken 값을 추가
        if(accessToken != null){
          xhr.setRequestHeader('access',accessToken);
        }else{
          reissue();
        }
      },
      success: function(data) {
        alert(data);
      },
      error: function(xhr, status, error) {
        console.log("Status: " + status);
        console.log("Error: " + error);
      }
    });
  }


  function reissue(){

    var myCookie = getCookie("refresh");

    console.log(myCookie);

    $.ajax({
      type: "POST",
      url: "http://localhost:8081/reissue",
      dataType : 'text',
      xhrFields: {
        withCredentials: true   // 쿠키를 요청 헤더에 포함
      },
      success: function(data) {
        alert(data);
      },
      error: function(xhr, status, error) {
        console.log("Status: " + status);
        console.log("Error: " + error);
      }
    });
  }

  function logout(){
    $.ajax({
      type: "POST",
      url: "http://localhost:8081/logout",
      dataType : 'text',
      xhrFields: {
        withCredentials: true   // 쿠키를 요청 헤더에 포함
      },
      success: function(data) {
        alert(data);
      },
      error: function(xhr, status, error) {
        console.log("Status: " + status);
        console.log("Error: " + error);
      }
    });
  }

  function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length === 2) return parts.pop().split(";").shift();
  }
</script>
</html>
